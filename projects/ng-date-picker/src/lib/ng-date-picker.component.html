<!--**
 * @(#)ng-date-picker.component.html Sept 05, 2023

 * @author Aakash Kumar
 *-->
<div class="date-picker-main" cdkOverlayOrigin #trigger>
  <mat-form-field class="w-full" [class]="{'display-hidden':isShowStaticDefaultOptions}" (click)="toggleDateOptionSelectionList($event)">
    <mat-label (click)="toggleDateOptionSelectionList($event)">{{inputLabel}}</mat-label>
    <input matInput readonly="readonly" #dateInput class="cursor-pointer" id="date-input-field">
    @if (!!dateInput.value) {
      <button mat-icon-button matSuffix class="cursor-pointer pe-0 ps-0" matTooltip="Clear"
      (click)="clearSelection($event)">
        <mat-icon>clear</mat-icon>
      </button>
    }
    <button mat-icon-button matSuffix class="cursor-pointer"> <mat-icon>date_range</mat-icon></button>
  </mat-form-field>

  @if(dateDropDownOptions.length && isShowStaticDefaultOptions) {
    <ng-container *ngTemplateOutlet="dateOptionList;
      context: {
        $implicit: visibleOptions(),
        dateInput: dateInput,
        optionId: staticOptionId,
        className:'w-full custom-ckd-container range-input',
      }"
    ></ng-container>
  }

  <ng-template cdkConnectedOverlay [cdkConnectedOverlayHasBackdrop]="false" [cdkConnectedOverlayOrigin]="trigger"
    [cdkConnectedOverlayOpen]="isDateOptionList" [cdkConnectedOverlayPush]="cdkConnectedOverlayPush"
    [cdkConnectedOverlayOffsetX]="listCdkConnectedOverlayOffsetX"
    [cdkConnectedOverlayOffsetY]="listCdkConnectedOverlayOffsetY"
    (overlayOutsideClick)="!isShowStaticDefaultOptions && toggleDateOptionSelectionList()">

    @if(dateDropDownOptions.length && !isShowStaticDefaultOptions) {
      <ng-container *ngTemplateOutlet="dateOptionList;
        context: {
          $implicit: visibleOptions(),
          dateInput: dateInput,
          optionId: dynamicOptionId,
          className:'w-full custom-ckd-container range-input',
        }"
      ></ng-container>
    }
  </ng-template>

  <ng-template cdkConnectedOverlay [cdkConnectedOverlayHasBackdrop]="false" [cdkConnectedOverlayOrigin]="trigger"
    [cdkConnectedOverlayOpen]="isCustomRange" [cdkConnectedOverlayPush]="cdkConnectedOverlayPush"
    [cdkConnectedOverlayPositions]="cdkConnectedOverlayPositions"
    [cdkConnectedOverlayOffsetX]="cdkConnectedOverlayOffsetX" [cdkConnectedOverlayOffsetY]="cdkConnectedOverlayOffsetY"
    (overlayOutsideClick)="toggleCustomDateRangeView()">
    <div class="custom-ckd-container custom-calendar-container" [class]="{'without-default-opt':hideDefaultOptions}">
      <div class="row-1">
        @if (!hideDefaultOptions) {
          <div class="pt-custom br-right column-1">
            <ng-container
              *ngTemplateOutlet="dateOptionList;
              context: {
                $implicit: visibleOptions(),
                dateInput: dateInput,
              }"
            ></ng-container>
          </div>
        }
        <div class="mt-2 column-2"><lib-calendar [selectedDates]="selectedDates" #calendar [minDate]="minDate"
            [maxDate]="maxDate"></lib-calendar></div>
      </div>
      <div class="row-2 br-top">
        <div class="text-end my-2 w-full">
          <div class="footer-content">
            <span id="range-label-text">
              {{calendar?.selectedDates?.start | date: dateFormat}}
              @if (calendar?.selectedDates?.end) {
                <span> - {{calendar.selectedDates?.end | date: dateFormat}} </span>
              }
            </span>
            <div class="d-inline buttons">
              <button mat-button mat-raised-button class="p-3 mx-2" (click)="isCustomRange=false;">Cancel</button>
              <button mat-button mat-raised-button color="primary" class="ms-2 p-3"
                [class.disabled]="!(calendar?.selectedDates?.start && calendar?.selectedDates?.end)"
                (click)="updateCustomRange(dateInput,calendar.selectedDates);">&nbsp;Apply&nbsp;</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-template>
</div>

<ng-template #dateOptionList let-options let-input="dateInput" let-optionId="optionId" let-className="className">
  <mat-action-list [ngClass]="className" [id]="optionId">
    @for (option of options; track option.optionLabel) {
      <mat-list-item [activated]="option.isSelected" (click)="updateSelection(option, input)">
        {{option.optionLabel}}
      </mat-list-item>
    }
  </mat-action-list>
</ng-template>
